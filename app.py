# -*- coding: utf-8 -*-
"""emma.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15YsDsyz4O2f8ZRb0WDs_4iQUYaPpnzvj
"""
from flask import Flask, request, render_template_string
import pandas as pd

app = Flask(__name__)

# Caminho do arquivo no sistema
file_path = 'teste 1.xlsx'

# Carregar a planilha Excel
df = pd.read_excel(file_path)

def search_in_spreadsheet(term):
    results = df[df['Palavras chaves'].str.contains(term, case=False, na=False)]
    if not results.empty:
        return results['TÃ­tulo do documento'].tolist()
    else:
        return []

def get_link_by_title(title):
    result = df[df['TÃ­tulo do documento'] == title]
    if not result.empty:
        return result['Link Qualyteam'].values[0]
    else:
        return None

@app.route('/', methods=['GET', 'POST'])
def home():
    if request.method == 'POST':
        search_term = request.form.get('search_term')
        results = search_in_spreadsheet(search_term)
        return render_template_string('''
            <h1>Emaboot Chatbot</h1>
            <p>ðŸ¤– Emaboot: Documentos encontrados:</p>
            <ul>
            {% for title in results %}
                <li><a href="/get_link?title={{ title }}">{{ title }}</a></li>
            {% endfor %}
            </ul>
            <a href="/">Voltar</a>
        ''', results=results)
    return render_template_string('''
        <h1>Emaboot Chatbot</h1>
        <form method="POST">
            <label>ðŸ¤– Emaboot: Qual documento procura hoje?</label><br>
            <input type="text" name="search_term">
            <input type="submit" value="Enviar">
        </form>
    ''')

@app.route('/get_link')
def get_link_route():
    title = request.args.get('title')
    link = get_link_by_title(title)
    if link:
        return f'<a href="{link}" target="_blank">Clique aqui para acessar {title}</a><br><a href="/">Voltar</a>'
    else:
        return 'Link nÃ£o encontrado.<br><a href="/">Voltar</a>'

if __name__ == "__main__":
    app.run(debug=True)
