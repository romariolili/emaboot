# -*- coding: utf-8 -*-
"""emma.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15YsDsyz4O2f8ZRb0WDs_4iQUYaPpnzvj
"""
from flask import Flask, request, render_template_string
import pandas as pd

app = Flask(__name__)

# Carregar a planilha Excel
file_path = 'teste 1.xlsx'
df = pd.read_excel(file_path)

def search_in_spreadsheet(term):
    # Certifica-se de que a busca considera o termo em qualquer parte da c矇lula
    results = df[df['Palavras chaves'].str.contains(term, case=False, na=False, regex=True)]
    if not results.empty:
        return results['T穩tulo do documento'].tolist()
    else:
        return []

def get_link_by_title(title):
    result = df[df['T穩tulo do documento'] == title]
    if not result.empty:
        return result['Link Qualyteam'].values[0]
    else:
        return None

@app.route("/", methods=["GET", "POST"])
def home():
    if request.method == "POST":
        search_term = request.form["search_term"]
        results = search_in_spreadsheet(search_term)
        return render_template_string('''
            <h1>Emaboot Chatbot</h1>
            <form method="post">
                <label> Emaboot: Qual documento procura hoje?</label><br>
                <input type="text" name="search_term">
                <input type="submit" value="Enviar">
            </form>
            {% if results %}
                <p> Emaboot: Documentos encontrados:</p>
                <ul>
                {% for result in results %}
                    <li>{{ loop.index }}. {{ result }}</li>
                {% endfor %}
                </ul>
                <a href="/">Voltar</a>
            {% else %}
                <p> Emaboot: Nenhum documento encontrado com essas palavras-chave.</p>
                <a href="/">Voltar</a>
            {% endif %}
        ''', results=results)
    return render_template_string('''
        <h1>Emaboot Chatbot</h1>
        <form method="post">
            <label> Emaboot: Qual documento procura hoje?</label><br>
            <input type="text" name="search_term">
            <input type="submit" value="Enviar">
        </form>
    ''')

if __name__ == "__main__":
    app.run(debug=True)
